services:
  # 1. Banco de Dados (pserv)
  - type: pserv
    name: p2-database
    plan: free
    runtime: postgresql           # ðŸ‘ˆ IMPORTANTE: define o tipo correto
    disk:
      name: data
      mountPath: /var/lib/postgresql
      sizeGB: 1

  # 2. Backend em Docker
  - type: web
    name: p2-backend
    runtime: docker               # ðŸ‘ˆ OBRIGATÃ“RIO
    dockerContext: .
    dockerfilePath: Dockerfile
    autoDeploy: true
    plan: free
    envVars:
      - key: DATABASE_URL
        value: ${fromDatabase.p2-database.connectionString}
      - key: NODE_ENV
        value: production

  # 3. Frontend em Docker
  - type: web
    name: p2-frontend
    runtime: docker               # ðŸ‘ˆ OBRIGATÃ“RIO
    dockerContext: ./frontend
    dockerfilePath: Dockerfile
    autoDeploy: true
    plan: free
    envVars:
      - key: VITE_API_URL
        value: ${fromService.p2-backend.defaultUrl}
