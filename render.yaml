services:
  # 1. Banco de Dados PostgreSQL Gerenciado
  - type: pserv
    name: p2-database
    plan: free

  # 2. Servi√ßo de Backend (Node.js/Docker)
  - type: web
    name: p2-backend
    dockerContext: .
    dockerfilePath: Dockerfile # Corrigido
    autoDeploy: true
    # üö® CR√çTICO: REMOVIDO 'env: node' para for√ßar o deploy Docker
    plan: free
    # Removido 'port: 3001'
    
    buildCommand: npm install
    startCommand: node app.js 
    
    envVars:
      # CORRE√á√ÉO DE SINTAXE: Usando o formato aninhado para referenciar servi√ßos
      - key: DATABASE_URL
        value:
          fromDatabase: p2-database
          property: connectionString
      
      - key: NODE_ENV
        value: production

  # 3. Servi√ßo de Frontend (React/Vite com Nginx/Docker)
  - type: web
    name: p2-frontend
    dockerContext: ./frontend
    dockerfilePath: Dockerfile # Corrigido
    autoDeploy: true
    plan: free
    # Removido 'port: 80'
    
    envVars:
      # CORRE√á√ÉO DE SINTAXE: Mapeia a URL p√∫blica do Backend
      - key: VITE_API_URL
        value:
          fromService: p2-backend
          property: defaultUrl