services:
  # 1. Banco de Dados PostgreSQL Gerenciado
  - type: pserv
    name: p2-database
    plan: free # Linhas 4 e 5 corrigidas (removido databaseName e user)

  # 2. ServiÃ§o de Backend (Node.js)
  - type: web
    name: p2-backend
    dockerContext: .
    dockerfilePath: Dockerfile # ðŸš¨ Corrigido: dockerfile -> dockerfilePath
    autoDeploy: true
    env: node
    plan: free
    # ðŸš¨ Removido 'port: 3001' (Linha 14 corrigida)
    
    buildCommand: npm install
    startCommand: node app.js 
    
    envVars:
      # ðŸš¨ CORREÃ‡ÃƒO DE SINTAXE: Mapeamento da URL de ConexÃ£o do PostgreSQL
      - key: DATABASE_URL
        value: ${{ fromDatabase.p2-database.connectionString }} # Sintaxe correta
      
      - key: NODE_ENV
        value: production

  # 3. ServiÃ§o de Frontend (React/Vite com Nginx)
  - type: web
    name: p2-frontend
    dockerContext: ./frontend
    dockerfilePath: Dockerfile # ðŸš¨ Corrigido: dockerfile -> dockerfilePath
    autoDeploy: true
    plan: free
    # ðŸš¨ Removido 'port: 80' (Linha 39 corrigida)
    
    envVars:
      # ðŸš¨ CORREÃ‡ÃƒO DE SINTAXE: Mapeia a URL pÃºblica do Backend
      - key: VITE_API_URL
        value: ${{ fromService.p2-backend.defaultUrl }} # Sintaxe correta